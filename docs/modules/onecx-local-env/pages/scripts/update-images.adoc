ifdef::env-site[]
include::partial$_attributes.adoc[]
endif::[]
:imagesdir: ../../images

= Update local Docker images

To run a local OneCX instance, Docker images with the latest version are downloaded and used. Over time, these images become outdated, meaning that even if a newer version is available, the old version is still being used locally. Check versions with script xref:./check-images.adoc[check-images.sh].

The *update-images.sh* script is used to renew local Docker images. It can be run from the root directory of the *onecx-local-env* repository.

.Command to display the available flags:
[source,bash]
----
./update-images.sh -h
----

[TIP]
====
To get an overview of the Docker images and their versions on your local machine, run the Docker command `*docker image ls*`. If images with the tag *<none>* are displayed, you can run the script with the parameter `*-c*` to clean them up.
====

[TIP]
====
After successfully updating the images, it is recommended to clean up outdated Docker resources using the command
[source,bash]
----
docker system prune
----
====


== Available Flags
The script accepts several optional flags to customize its behavior. Some flags can be combined.

The available flags are:

-a::
Update all images, ignoring name filter (if option *-n* is also used). +
If used in combination with *-c* then all orphaned images and stopped containers are removed.

-c::
Cleaned up orphaned images (e.g. if they have *<none>* in their name)
+
This option can be used in combination with *-n* or separately. If used without a name filter, all orphaned images will be removed. No additional confirmation is required.

-h::
Displays help information about the script and its available flags. If used then all other options are ignored.

-n <text>::
Name filter, update images which have <text> into image name


== Examples

=== Update UI Images
The Docker which have *ui* in image name are pulled from remote registry.

[source,bash]
----
./update-images.sh  -n ui
----

=== Cleanup only
Started without any name filter will remove all orphaned images. No additional confirmation is required.

.Excerpt from the list of orphaned images
image::scripts/script_check-images.sh_none-images.png[]

[source,bash]
----
./update-images.sh  -c
----

The deletion is only possible if the image is not in use. If so then stop the appropriate container first and try again.

.Image deletion failed
image::scripts/script_check-images.sh_rm-image-failed.png[]

=== Update all images and cleanup
With option *-a* all images are updated, ignoring name filter. With option *-c* all orphaned images are removed. No additional confirmation is required.

[source,bash]
----
./update-images.sh  -a -c
----
