ifdef::env-site[]
include::partial$_attributes.adoc[]
endif::[]
:imagesdir: ../../images

:toggle_shell_link:     xref:../scripts/toggle-mfes.adoc#integrate-onecx-shell[Integrate OneCX Shell]
:integrate_images_link: xref:./local_images.adoc[Integrate Local Docker Images]

= Integrate a local Microfrontend

This approach enables *hot-reloading* of your locally running micro-frontend: changes you make there are automatically visible in OneCX after the rebuild. The best way for fast frontend development.

== Start the local Microfrontend

Use one of the following command to start the Microfrontend. It depends on type of the Angular application.
In the following examples, 6021 is used as the port where the microfrontend is running locally. Adjust the port as needed.

.Start Angular "ng" Microfrontend on port 6021
[source,bash]
----
npm run start -- --port 6021 --host 0.0.0.0 --disable-host-check --public-host=http://localhost:6021
----

.Start Angular "nx" Microfrontend on port 6021
[source,bash]
----
npm run start -- --port=6021 --host 0.0.0.0 --disableHostCheck --publicHost=http://localhost:6021
----

CheckPoint::
Please check the microfrontend is up and running by accessing the *public host URL* (see start command) in Browser. The *remoteEntry.js* should be loaded.

.Local running Microfrontend
image::screenshot_successful-start-local-mfe.png[]


== Integrate the local Microfrontend into OneCX

The integration can be easily accomplished through routing and path rewriting by xref:../utilities.adoc#traefik[Traefik]. This is necessary because the Docker Compose project's network for OneCX is isolated from the outside world. And the meaning of "localhost" within the OneCX network (Docker uses "host.docker.internal" internally) differs from "localhost" outside of it. Therefore, requests from the Docker environment must be routed to the outside world and mapped to the localhost address.

This step is done with the script *toggle-mfes.sh*. It creates a configuration file with routing and path rewrite instructions that are read by Traefik. See also the documentation for xref:../scripts/toggle-mfes.adoc[toggle-mfes.sh].

Command for integrating the local app running on http://localhost:6021::
[source,bash]
----
./toggle-mfes.sh -a my-app:6021
----

.Successful Integration
image::screenshot_successful-activate-local-mfe.png[]

.Traefik Configuration located in `init_data/traefik/active`
[%collapsible%closed]
====
include::./_my-app_6021.adoc[]
====

[NOTE]
====
If the microfrontend requires its own backend functionality, then these backend services must also be started and presumably integrated into OneCX. The *./toggle-mfes.sh* script does not check this. See {integrate_images_link} for details on how to integrate additional backend services.

The method described here is for all microfrontends except the OneCX Shell. The OneCX Shell has a special role in OneCX and must be started with a specific command. See {toggle_shell_link} for details.
====
